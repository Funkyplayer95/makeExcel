<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>All Data</title>
    <style>
        table { width: 90%; margin: 0 auto;}
        th, td { padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>
<h1>All Data</h1>
<div>
<form action="/check" method="post">
    <button type="submit" >조회하기</button>
</form>

<button onclick="add_row()">추가</button>
<button onclick="save_data()">저장</button>
<button onclick="delete_row()">삭제</button>

<form action="/download" method="post">
    <button type="submit" >엑셀 다운로드</button>
</form>

<form action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" name="file" accept=".xls,.xlsx"> <!--엑셀파일만 선택할 수 있도록-->
    <input type="submit" value="파일첨부"/>
</form>

</div>
<table id="data_table">
    <thead>
    <tr>
        <th>체크</th>
        <th>옷 코드</th>
        <th>옷 종류</th>
        <th>옷 가격</th>
        <th>판매 수량</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="data : ${allData}">
        <td><input type="checkbox" class="delete" th:value="${data.code}" required></td>
        <td th:text="${data.code}"></td>
        <td th:text="${data.name}"></td>
        <td th:text="${data.price}+' 원'"></td>
        <td th:text="${data.salesQ}"></td>
    </tr>
    </tbody>
</table>

<script th:inline="javascript">
    /*<![CDATA[*/
    var message = /*[[${message}]]*/ ;

    if (message) { alert(message); }

    /*]]>*/
</script>

<script>
    function add_row() {
        var table = document.getElementById("data_table");
        var row = table.insertRow(-1); // -1 = 마지막행
        var cell1 = row.insertCell(0); // 1번째 열
        var cell2 = row.insertCell(1); // 2번째 열
        var cell3 = row.insertCell(2); // 3번째 열
        var cell4 = row.insertCell(3); // 4번째 열
        var cell5 = row.insertCell(4); // 5번째 열
        cell1.innerHTML = '<input type="checkbox" class="delete" th:value="${data.code}">'; // 체크박스 만들기
        cell2.innerHTML = '<input type="text" id="newCode">'; // code 입력 란
        cell3.innerHTML = '<input type="text" id="newName">'; // name 입력 란
        cell4.innerHTML = '<input type="text" id="newPrice">'; // price 입력 란
        cell5.innerHTML = '<input type="text" id="newSalesQ">'; // salesQ 입력 란
    }

    function save_data() {
    var newCode = document.getElementById("newCode").value;
    var newName = document.getElementById("newName").value;
    var newPrice = document.getElementById("newPrice").value;
    var newSalesQ = document.getElementById("newSalesQ").value;

    var xhr = new XMLHttpRequest(); // XMLHttpRequest객체를 생성
    xhr.open("POST", "/save", true); // post방식으로 , /save를 찾아서 / 비동기 요청 보냄
    xhr.setRequestHeader("Content-Type", "application/json"); // json방식으로 보냄
    xhr.send(JSON.stringify({code: newCode, name: newName, price: newPrice, salesQ: newSalesQ})); // 키 : 값 형식으로 보냄.
    }

    function delete_row() {
    var check = document.getElementsByClassName("delete");
    var deleteValue = []; // 배열 생성
    for (var i = 0; i < check.length; i++) {  // check 배열 길이만큼 반복
        if (check[i].checked) { // [i]번째에 체크가 되었다면
            deleteValue.push(check[i].value); // deleteValue배열에 value값을 추가
        }
    }
    var xhr = new XMLHttpRequest(); // XMLHttpRequest객체를 생성
    xhr.open("POST", "/delete", true); // post방식, /delete, 비동기 요청 보냄
    xhr.setRequestHeader("Content-Type", "application/json"); // json방식으로 보낸다.
    xhr.send(JSON.stringify(deleteValue)); // deleteValue 배열을 json 문자열로 변환 후 서버에 보냄.
    }

</script>
</body>
</html>